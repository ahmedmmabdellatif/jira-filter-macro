app:
  # The `id` field is intentionally omitted. When deploying for the first time,
  # run `forge register` or `forge deploy` to have the Forge CLI assign a unique
  # app identifier. The CLI will automatically update your manifest with the
  # generated app ID once registration completes.
  runtime:
    # Specify the Node.js runtime that backs your functions. The runtime name must
    # include an ".x" suffix; for example, use "nodejs20.x" instead of
    # "nodejs20"【748473698955597†L64-L69】.
    name: nodejs20.x

modules:
  # Define a Confluence macro module. Forge v12 uses the `macro` key rather than
  # the legacy `confluence:macro` key【799124642826588†L109-L116】. Each macro entry
  # specifies its own resource (for the iframe), resolver function, and optional
  # configuration panel.
  macro:
    - key: jira-filter-replica-macro
      title: Jira Filter Replica
      description: A replica of the native Jira Filter macro.
      # The front‑end bundle that renders the macro. This key must correspond to
      # an entry in the top‑level `resources` section【801528993977902†L93-L98】.
      resource: main-app
      # Backend resolver invoked by the macro. Points to the function module
      # defined below.
      resolver:
        function: main-resolver
      # Define a custom configuration panel for the macro. According to the
      # manifest specification, the object form of `config` must include a
      # `resource` property referencing a static resource and may include a
      # `title`. The `type` field used in the previous manifest is not part of
      # the schema【799124642826588†L108-L128】.
      config:
        title: Configure macro
        resource: macro-config

  # Declare function modules. Each function has a key and a handler file.
  function:
    - key: main-resolver
      handler: index.run

# Static resources used by the macro and its configuration panel. These must be
# declared at the top level rather than under `modules`【801528993977902†L93-L98】.
resources:
  - key: main-app
    path: static/jira-macro/build
  - key: macro-config
    path: static/jira-macro/build

permissions:
  scopes:
    # Grant permission to read Jira filters and user data. These scopes are
    # required to call the Jira REST API via @forge/api【748473698955597†L64-L69】.
    - read:jira-work
    - read:jira-user
  # The `external` section defines non-Atlassian domains your app can access
  # using `fetch` in the backend. Calls to Atlassian domains (like
  # api.atlassian.com) are implicitly allowed and don't require egress
  # declarations. Remove the deprecated `fetch.backend` entry to satisfy the
  # latest Forge linter【799124642826588†L109-L116】.
  external:
    fetch: {}